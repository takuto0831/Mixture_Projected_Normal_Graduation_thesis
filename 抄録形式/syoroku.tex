\documentclass[a4j,11pt]{jarticle}
%\usepackage[dviout]{graphicx}
\usepackage[dvipdfmx]{graphicx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{ascmac}
%\usepackage{epsbox}
\usepackage{float}
%\usepackage{graphics}
\usepackage{here}
\usepackage{lscape}
\usepackage{latexsym}
\usepackage{pifont}
\usepackage{wrapfig}
\usepackage{type1cm}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{txfonts}
\usepackage{bm}
\usepackage{comment}
\usepackage{url}
\usepackage[square]{natbib}

%\bibliographystyle{apalike} %いらない
%\setlength{\voffset}{-25.4mm}
\setlength{\topmargin}{-17.5mm}   %トップとヘッダの間隔
%\setlength{\headheight}{20mm}   %ヘッダの高さ
%\setlength{\headsep}{0mm}   %ヘッダとテキストの間隔
\setlength{\textwidth}{45zw}   %テキストの幅
\setlength{\hoffset}{-10mm}
\setlength{\textheight}{45\baselineskip}   %テキストの高さ
%\addtolength{\textheight}{\topskip}
%\setlength{\footskip}{0mm}
%\setlength{\oddsidemargin}{21.5mm}   %サイドとテキストの間隔（奇数ページ）
%\setlength{\evensidemargin}{21.5mm}   %サイドとテキストの間隔（偶数ページ）
\pagestyle{empty}   %ページ番号なし
\newcommand{\g}[1]{\boldsymbol{#1}}
\newcommand{\lw}[1]{\smash{\lower2.0ex\hbox{#1}}}
\renewcommand{\baselinestretch}{1.0}

\makeatletter
\def\theequation{\arabic{equation}}   %数式番号を(章.式)形式
\@addtoreset{equation}{section}
%\def\thefigure{\thesection.\arabic{figure}}   %図番号を(章.図)形式
%\@addtoreset{figure}{section}
%\def\thetable{\thesection.\arabic{table}}   %表番号を(章.表)形式
%\@addtoreset{table}{section}
\def\tr{\mathop{\operator@font tr}\nolimits}
\def\grad{\mathop{\operator@font grad}\nolimits}
\def\St{\mathop{\operator@font St}\nolimits}
\def\Hess{\mathop{\operator@font Hess}\nolimits}
\def\D{\mathop{\operator@font D}\nolimits}
\def\sym{\mathop{\operator@font sym}\nolimits}
\def\s.t.{\mathop{\operator@font s.t.}\nolimits}
\def\diag{\mathop{\operator@font diag}\nolimits}
\def\section{\@startsection{section}{1}{\z@}
   {0.8\Cvs \@plus.5\Cdp \@minus.2\Cdp}
   {0.2\Cvs \@plus.3\Cdp}
   {\normalfont \Large \bfseries}}
\makeatother
\makeatletter
\def\subsection{\@startsection{subsection}{1}{\z@}
   {0.8\Cvs \@plus.5\Cdp \@minus.2\Cdp}
   {0.2\Cvs \@plus.3\Cdp}
   {\normalfont \normalsize \bfseries}}
\makeatother
\makeatletter
\newcommand{\figcaption}[1]{\def\@captype{figure}\caption{#1}}
\newcommand{\tblcaption}[1]{\def\@captype{table}\caption{#1}}
\makeatother
\begin{document}
\bibliographystyle{jecon}

\begin{center}
{\Large \textbf{ベイジアンネットワークによる予測モデル}}
\end{center}
\begin{flushright}
小坪 琢人（塩濱 敬之准教授）
\end{flushright}
\vspace{-3zh}

%%%%%これ以下, 本文%%%%%

\section{はじめに}
\vspace{-0.6zh}

コンピュータ, ソフトウェア, インターネット技術などの情報技術は目覚しく発達し, 人間の生活はインターネットに大きく依存している形である. またインターネット通販サイトAmazon.comに見られる, その人にとってのお薦め商品を自動的に選ぶリコメンデーション機能や, Googleで用いられている重要なページを上位にランク付けする PageRank などは人間の意思決定にも大きく影響している. こうした機能は本人さえも気付いていない趣向性を明らかにすることもあるが, ユーザーの選択肢が狭める可能性がある.

Amazon.com リコメンドを例にとって説明すると, 各ユーザーの購入した商品を記録し, 同様の商品購入パターンを持つ他のユーザーとグループ化する. そのグループ内であるユーザはまだ購入していないが, 他のユーザーが購入しているものを, リコメンドするという仕組みである. この手法は協調フィルタリングと呼ばれている. Amazon のように多くのユーザーを抱える企業では, 様々な特徴をもつユーザーも観測できるので, 精度の高いリコメンドを行うことが出来る.

コンピュータが自動的に人間に情報を与えてくれるのは便利であるが, 問題点もある. 自動化の問題点としては, 分析やシュミレーションの実態が見えにくくなるという点である. 機械がある種のブラックボックスとなり, 都合よく利用されてしまう可能性がある. 人間が生活していくうえで, 重要視されるのは効率性よりも人間らしい判断である. その中で機械による効率的な自動化は, 意思決定に不信感をもたらす危険性を持っている.

それらを解決する方法として, 可視化というものが存在する. グラフやプロットにより数値的根拠を明らかにすることで, ブラックボックス化を防ぐことができる. 一般に可視化は得られた結果の解釈の手助けとして用いられているが, モデル自体が視覚的に解釈できるものも存在する. 例としては決定木やグラフィカルモデルなどである. 本論文ではこのグラフィカルモデルについて取り上げる. 
%%% グラフィカルモデルの本読んでもう少し書くよ
%%% 因果関係のことどこにいれる？？

グラフィカルモデルは以下のような特徴を持つ. \citep{SKM}

\begin{enumerate}

\item 確率モデルの構造を視覚化する簡単な方法を提供し, 新しいモデルの設計方針を決めるのに役立つ.

\item グラフの構造を調べることにより, 条件付独立性などのモデルの性質に関する知見が得られる.

\item 精巧なモデルにおいて推論や学習を実行するためには複雑な計算が必要となるが, これを数学的な表現で暗に伴うグラフ上の操作として表現することができる.

\end{enumerate}

グラフはリンク(link)によって接続されたノード(node)の集合からなる. 確率的グラフィカルモデルでは, 各ノードが確率変数を, リンクがこれらの変数間の確率的関係を表現する. 本論では有向グラフィカルとも呼ばれる, ベイジアンネットワーク(Bayesian network)を用いた分類モデルについて議論する.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{ネットワークモデリング}

\subsection{ベイジアンネットワーク}

ベイジアンネットワークは, 確率変数間の条件付依存関係を表した非循環型有向グラフ(DAG: Directed Acyclic Graph)で, 各種推論などに用いられる. 各ノードは確率変数を表し, 有向辺は変数間の直接の依存関係を表す. 一般には各変数は離散値を取るが, 閾値を定めて離散値に変換すれば連続値にも適用可能である. ベイジアンネットワークでは, リンクの先にあるノードを子ノード$(X_j)$, リンクの元にあるノードを親ノード$(X_i)$と呼ぶ. 親ノードが複数あるとき子ノード$X_j$の親ノードの集合を$Pa(X_j)$と書くことにする. $X_j$と$Pa(X_j)$の間の依存関係は次の条件付確率によって表される. ただし$Pa(X_j)$が空集合の時, $X_j$はベイジアンネットワークの始点であるので, 事前確率分布($P(X_j))$となる.

\begin{eqnarray}
\label{eq1}
P(X_j | Pa(X_j)) = \frac{P(X_j, Pa(X_j))}{P(Pa(X_j))} 
\end{eqnarray}

さらに$n$個の確率変数$X_1, \dots, X_n$のそれぞれを子ノードとして同様に考えると, 全ての確率変数の同時確率分布は式(\ref{eq2})のように表せる.

\begin{eqnarray}
\label{eq2}
P(X_1, \dots, X_n) = \prod_{j=1}^n P(X_j | Pa(X_j))
\end{eqnarray}

上記の式(\ref{eq1})に基づいて, 各ノードについて条件付確率を求めた表を条件付確率表(CPT)といい, 各行の和は必ず$1$になる. 任意の子ノードはそのノードの親ノードのいずれかに起因するので総和は$1$となる (親ノード集合に含まれていないノードを条件とした条件付確率は$0$となる). 条件付確率表の例を表(\ref{cpt})に示す. 

\begin{table}[H]
\begin{center}
\caption{条件付確率表（CPT）}   %キャプション
\label{cpt}   %ラベル
\begin{tabular}{|c||c|c|c|}   %{}で文字の揃え方を指定
\hline
 & $Pa(X_{j})=x_{1}$ & \dots & $Pa(X_{j})=x_{m}$
\\ \hline
$X_j=y_1$ & $p(y_1|Pa(X_j)=x_1)$ & \dots & $p(y_1|Pa(X_j)=x_m)$
\\ \hline
$\vdots$ & $\vdots$ & $\ddots$ & $\vdots$
\\ \hline
$X_j=y_n$ & $ p(y_n|Pa(X_j)=x_1)$ & \dots & $p(y_n|Pa(X_j)=x_m)$
\\ \hline
\end{tabular}
\end{center}
\end{table}

\section{データ解析}

\subsection{解析データ}

本研究では, ある美容院の店舗マスタ, 担当者マスタ, 商品マスタ, 顧客マスタ, 会計履歴, 会計明細を用いて顧客のクラスタリングを行う. 
以下にデータの詳細を示す. 

\begin{table}[H]
\begin{center}
\caption{解析データ}   %キャプション
\label{hairdata}   %ラベル
\begin{tabular}{c l}
\hline
店舗マスタ & 店舗ID, 店舗名, 緯度, 経度, 階数 \\

担当者マスタ　& 担当者ID, 担当者所属店舗 \\

商品マスタ & 会計明細販売商品ID, 商品種別,  第1カテゴリID, 第1カテゴリ, 第2カテゴリID, \\
               &  第2カテゴリ, 商品名, 商品略称, 本部設定税抜価格, 本部設定税込価格, 施術分数, \\
               & 販売開始日, 販売終了日, 予約カテゴリー, 予約商品名\\

顧客マスタ & 顧客ID, 初回来店年, 初回来店店舗ID, 初回来店店舗ID, 郵便番号, \\
              & DM送信可否, 性別, 誕生年代, 備考 \\

会計履歴 & 会計ID, 販売店舗ID, 会計日, 会計時刻, 顧客ID, 会計税込売上, 会計消費税,取引種別, \\
             &  POS入力担当者ID, 会計主担当者ID, 会計指名区分, DV商品券金額, DV商品券枚数,\\
             &  現金, クレジット, 電子マネー, 売掛金, 他社商品券金額, 他社商品券枚数, 商品券利用枚数, \\
             &  利用商品券ID,ポイント利用額, ポイント利用区分, ポイント付与額, \\
            &  ポイント残高, 累積来店回数, 曜日\\

会計明細 & 会計明細ID, 会計ID, 明細商品種別, 会計明細税込定価売上, 会計明細割引額, \\
              & 会計明細消費税, 会計明細販売商品ID, 会計明細販売担当者ID, 会計明細指名区分 \\
\hline
\end{tabular}
\end{center}
\end{table}

\section{まとめ}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newpage
\addcontentsline{toc}{section}{参考文献} %目次に参考文献を入れる

%必要になる
%\newpage
%\section{付録}

%参考文献を引用する際に必要なコマンド
\bibliographystyle{jplain}
\bibliography{bunken}

\end{document}